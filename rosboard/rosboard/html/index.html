<!-- 
  roslaunch rosbridge_server rosbridge_websocket.launch
  /home/cwh/web_ws/src/rosboard/rosboard/html
  
  del:
  rosrun tf2_web_republisher tf2_web_republisher //tf
 -->
<!doctype html>

<html lang="zh">

<head>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta http-equiv="content-type" content="txt/html; charset=utf-8" />
  <link href="css/material-icons.css" media="all" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="js/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="></script>
  <link rel="stylesheet" href="css/material.indigo-blue.min.css" />
  <link rel="stylesheet" href="css/uPlot.min.css">
  <link rel="stylesheet" href="css/leaflet.css">
  <link href="css/index.css" media="all" rel="stylesheet" type="text/css">

  <!--cwh css  -->
  <link href="mycss.css" media="all" rel="stylesheet" type="text/css">
  <!-- Bootstrap 的 CSS 文件 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">


  <!-- 选项 1：jQuery 和 Bootstrap 集成包（集成了 Popper） -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
    crossorigin="anonymous"></script>


  <script type="text/javascript" src="js/json5.min.js"></script>
  <script type="text/javascript" src="js/uPlot.iife.min.js"></script>
  <script type="text/javascript" src="js/jquery.transit.min.js"></script>
  <script type="text/javascript" src="js/masonry.pkgd.min.js"></script>
  <script type="text/javascript" src="js/eventemitter2.min.js"></script>
  <script text="text/javascript" src="js/import-helper.js"></script>
  <script type="text/javascript" src="js/material.min.js" defer></script>
  <script type="text/javascript" src="js/leaflet.js"></script>
  <script type="text/javascript" src="js/gl-matrix.js"></script>
  <script type="text/javascript" src="js/litegl.min.js"></script>
  <script type="text/javascript" src="js/index.js" defer></script>

  <title>ROSboard</title>
</head>

<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <!-- Title -->
        <span class="mdl-layout-title">ROSboard</span>
        <!-- Add spacer, to align navigation to the right -->
        <div class="mdl-layout-spacer"></div>

        <!-- <button style="height: 40px; margin-left: 100px;" onclick="cmd_vel()">send cmd_vel</button> -->

        <nav class="mdl-navigation mdl-layout--large-screen-only cwhtest">
          <button type="button" class="btn mdl-navigation__link" data-toggle="modal" data-target="#exampleModalone">
            建图
          </button>
          <button type="button" class="btn mdl-navigation__link" data-toggle="modal"
            data-target="#exampleModaltwo">录包</button>
          <button type="button" class="btn mdl-navigation__link">导航</button>
          <button type="button" class="btn mdl-navigation__link">Link</button>
        </nav>
      </div>
    </header>

    <!-- NDT_Mapping -->
    <div class="modal fade" id="exampleModalone" tabindex="-1" aria-labelledby="exampleModaloneLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModaloneLabel">NDT Mapping</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>

              <ul class="list-group">

                <li class="list-group-item">topic: /config/ndt_mapping</li>

                <li class="list-group-item">
                  <!-- Resolution -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_resolution_span">Resolution</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_resolution"
                      aria-describedby="ndt_mapping_resolution_span" value="1">
                  </div>
                  <!-- Step Size -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_step_size_span">Step Size</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_step_size"
                      aria-describedby="ndt_mapping_step_size_span" value="0.1">
                  </div>
                  <!-- Transformation Epsilon -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_transformation_epsilon_span">Transformation
                        Epsilon</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_transformation_epsilon"
                      aria-describedby="ndt_mapping_transformation_epsilon_span" value="0.01">
                  </div>
                  <!-- Maximum iterations -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_maximum_iterations_span">Maximum iterations</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_maximum_iterations"
                      aria-describedby="ndt_mapping_maximum_iterations_span" value="30">
                  </div>
                  <!-- Leaf Size -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_leaf_size_span">Leaf Size</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_leaf_size"
                      aria-describedby="ndt_mapping_leaf_size_span" value="1.01">
                  </div>
                  <!-- Minimum Scan Range -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_minimum_scan_range_span">Minimum Scan Range</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_minimum_scan_range"
                      aria-describedby="ndt_mapping_minimum_scan_range_span" value="5">
                  </div>
                  <!-- Maximum Scan Range -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_maximum_scan_range_span">Maximum Scan Range</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_maximum_scan_range"
                      aria-describedby="ndt_mapping_maximum_scan_range_span" value="200">
                  </div>
                  <!-- Maximum Add Scan Shift -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_maximum_add_scan_shift_span">Maximum Add Scan
                        Shift</span>
                    </div>
                    <input type="number" class="form-control" id="ndt_mapping_maximum_add_scan_shift"
                      aria-describedby="ndt_mapping_maximum_add_scan_shift_span" value="1">
                  </div>
                </li>
                <!-- Method Type -->
                <li class="list-group-item">

                  <!-- PCD OUTPUT -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="ndt_mapping_output_span">PCD filename</span>
                    </div>
                    <input type="text" class="form-control" id="ndt_mapping_output"
                      aria-describedby="ndt_mapping_output_span" value="xxx.pcd">
                    <button type="button" class="btn btn-success" onclick="pcdOutput()">PCD OUTPUT</button>
                  </div>
                </li>
              </ul>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="startNdtMapping()">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ROSBAG -->
    <div class="modal fade" id="exampleModaltwo" tabindex="-1" aria-labelledby="exampleModaltwoLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModaltwoLabel">NDT Mapping</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <ul class="list-group">
                <li class="list-group-item">录包</li>
                  <!-- ROSBAG OUTPUT -->
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="rosbag_output_span">rosbag filename</span>
                    </div>
                    <input type="text" class="form-control" id="rosbag_output"
                      aria-describedby="rosbag_output_span" value="xxx.bag">
                    <button type="button" class="btn btn-success" onclick="rosbagOutput()">ROSBAG OUTPUT</button>
                  </div>
                </li>
              </ul>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!-- <button type="button" class="btn btn-primary" onclick="startNdtMapping()">Save changes</button> -->
          </div>
        </div>
      </div>
    </div>


    <div class="mdl-layout__drawer">
      <nav id="topics-nav" class="mdl-navigation">
        <div id="topics-nav-system-title" class="topics-nav-title">System</div>
        <div id="topics-nav-system"></div>
        <div id="topics-nav-ros-title" class="topics-nav-title">ROS topics</div>
        <div id="topics-nav-ros"></div>
        <div style="opacity:0.3;" id="topics-nav-unsupported"></div>
      </nav>
    </div>
    <main class="mdl-layout__content">
      <div class="page-content">
        <div class="grid">
        </div>
      </div>
    </main>
  </div>
</body>
<script src="js/roslibjs/build/roslib.js"></script>
<!-- <script src="test_cmd_vel.js"></script>
  <script src="test_turtlesim.js"></script> -->
<script src="test_ndt_mapping.js"></script>
<script>
  var ros = new ROSLIB.Ros({
    url: 'ws://localhost:9090'
  })

  //判断是否连接成功并输出相应的提示消息到web控制台
  ros.on('connection', function () {
    console.log('localhost Connected to websocket server.');
  });

  //=================================================================

  function pcdOutput() {
    //发送topic
    // 只需要filename.pcd即可，保存在/home/cwh/real_data/中
    let pcdfilepath = $("#ndt_mapping_output").val();
    console.log('pcdOutput index.html:', pcdfilepath)
    //发送话题，保存这个值

    // Publishing a Topic
    var pcdOutputPub = new ROSLIB.Topic({
      ros: ros,
      name: 'cwh_output',
      messageType: 'std_msgs/String'
    });

    var filepathMsg = new ROSLIB.Message({
      data: pcdfilepath
    });

    pcdOutputPub.publish(filepathMsg);
  }

  function rosbagOutput() {
    let rosbagfilepath = $("#rosbag_output").val();
    var rosbagOutputPub = new ROSLIB.Topic({
      ros: ros,
      name: 'cwh_output',
      messageType: 'std_msgs/String'
    });

    var filepathMsg = new ROSLIB.Message({
      data: pcdfilepath
    });
    rosbagOutputPub.publish(filepathMsg);
  }


</script>

</html>